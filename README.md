# Code pipeline for Bui et al., 2025

## Overview
This repository contains code and data for analyzing WAT and BAT adipocyte precursor cells. The scripts in this repository are designed to clean data, perform statistical analysis, and generate  figures.


## Script to Figure Mapping

This table provides a quick reference to which script generates which specific figures.

| Figure                                                                                                     | Analysis             | Analysis subcategory                 | Script                                               | Language      | Note                                                                                                                                                                           |
|------------------------------------------------------------------------------------------------------------|----------------------|--------------------------------------|------------------------------------------------------|---------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Fig. EV1A- WAT UMAP without non-adipocells, grouped by original clusterings                                | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. EV1B- WAT UMAP without non-adipocells before CC regression, grouped by CC Phase                       | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. EV1C- WAT cell cycle distribution pre-regression                                                      | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Fig. EV1D - WAT UMAP without non-adipocells after CC regression, grouped by CC Phase                       | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. EV1E - WAT cell cycle distribution post-regression                                                    | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Fig. EV2A - markers of top 10% wAPC heatmap                                                                | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             | part of table EV1 (markers+ top 10% markers)                                                                                                                                   |
| Fig. 1B Pre-exclusion UMAP of WAT                                                                          | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 1D Plot violin plots of adipocells and non-adipocell markers                                          | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 1F - Final UMAP of WAT clusters after non-adipocell exclusion and CC regression                       | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 1H - Stacked violin plots of prominent markers                                                        | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 2D Feature plots                                                                                      | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             | run scenic pipeline first in 1.Seurat Processing/scenic_data/readme.txt                                                                                                        |
| Fig. 2F Regulon score patterns                                                                             | WAT                  | Scenic regulon                       | 1.Seurat Processing/wat_seurat_processing.Rmd        | R/python/bash |                                                                                                                                                                                |
| Table EV1 - wAPC markers                                                                                   | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             | part of table EV1 (markers+ top 10% markers)                                                                                                                                   |
| Table EV3 - DEGs between wCAPs vs wFAPLs                                                                   | WAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/wat_seurat_processing.Rmd        | R             | part of table EV3 (wCAPs drivers, dwfapls drivers, pathway analysis, PANTHER analysis, wCAPs vs wFAPLs DEGs)                                                                   |
| Fig. EV2A- bat UMAP without non-adipocells, grouped by original clusterings                                | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. EV2B- bat UMAP without non-adipocells before CC regression, grouped by CC Phase                       | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. EV2C- bat cell cycle distribution pre-regression                                                      | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Fig. EV2D - bat UMAP without non-adipocells after CC regression, grouped by CC Phase                       | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. EV2E - bat cell cycle distribution post-regression                                                    | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Fig. EV2B - markers of top 10% wAPC heatmap                                                                | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             | part of table EV2 (markers+ top 10% markers)                                                                                                                                   |
| Fig. 1C Pre-exclusion UMAP of bat                                                                          | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 1E Plot violin plots of adipocells and non-adipocell markers                                          | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 1G - Final UMAP of bat clusters after non-adipocell exclusion and CC regression                       | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 1I - Stacked violin plots of prominent markers                                                        | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 3D Feature plots                                                                                      | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             |                                                                                                                                                                                |
| Fig. 3F Regulon score patterns                                                                             | BAT                  | Scenic regulon                       | 1.Seurat Processing/bat_seurat_processing.Rmd        | R/python/bash | run scenic pipeline first in 1.Seurat Processing/scenic_data/readme.txt                                                                                                        |
| Table EV2 - bAPC markers                                                                                   | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             | part of table EV2 (markers+ top 10% markers)                                                                                                                                   |
| Table EV4 - DEGs between bCAPs vs bFAPLs                                                                   | BAT                  | Seurat filter, normalize, clustering | 1.Seurat Processing/bat_seurat_processing.Rmd        | R             | part of table EV4 (bCAPs drivers, bFAPLs drivers, pathway analysis, PANTHER analysis, bCAPs vs bFAPLs DEGs)                                                                    |
| Fig. 2A - WAT Macrostates                                                                                  | WAT RNA velocity     | CellRank                             | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. 2A right - WAT initial/terminal states                                                                | WAT RNA velocity     | CellRank                             | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. 2B -  WAT fate probabilities                                                                          | WAT RNA velocity     | CellRank                             | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. 2C - Temporal expressions of WAT driver genes                                                         | WAT RNA velocity     | CellRank                             | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. EV3A- WAT velocity colored by latent time                                                             | WAT RNA velocity     | ScVelo                               | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. EV3B - WAT macrostate compositions                                                                    | WAT RNA velocity     | CellRank                             | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. EV3C - WAT coarse grained transition matrix                                                           | WAT RNA velocity     | CellRank                             | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Table EV3 - wCAPs and wFAPLs drivers                                                                       | WAT RNA velocity     | CellRank                             | 2.RNA Velocity/WAT_RNA_velocity.ipnyb                | Python        | part of table EV3 (wCAPs drivers, dwfapls drivers, pathway analysis, PANTHER analysis, wCAPs vs wFAPLs DEGs)                                                                   |
| Fig. 3A - BAT Macrostates                                                                                  | BAT RNA Velocity     | CellRank                             | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. 3A right - BAT initial/terminal states                                                                | BAT RNA Velocity     | CellRank                             | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. 3B -  BAT fate probabilities                                                                          | BAT RNA Velocity     | CellRank                             | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. 3C - Temporal expressions of BAT driver genes                                                         | BAT RNA Velocity     | CellRank                             | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. EV4A- BAT velocity colored by latent time                                                             | BAT RNA Velocity     | ScVelo                               | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. EV4B - BAT macrostate compositions                                                                    | BAT RNA Velocity     | CellRank                             | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank. Input files located on github in the same folder without expression matrix. Users should regenerate normalized expression matrix themselves. |
| Fig. EV4C - BAT coarse grained transition matrix                                                           | BAT RNA Velocity     | CellRank                             | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | run scvelo first before cellrank                                                                                                                                               |
| Table EV4 - bCAPs and bFAPLs drivers                                                                       | BAT RNA Velocity     | CellRank                             | 2.RNA Velocity/BAT_RNA_velocity.ipnyb                | Python        | part of table EV4 (bCAPs drivers, bFAPLs drivers, pathway analysis, PANTHER analysis, bCAPs vs bFAPLs DEGs)                                                                    |
| Figure EV5A - UMAP of aggregated WAT and BAT before regression                                             | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure EV5B - UMAP of aggregated WAT and BAT before regression, grouped by depot                           | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure EV5C -  UMAP of aggregated WAT and BAT before regression, grouped by CC phase                       | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure EV5D - Cell count of each cluster in phase before CC regression                                     | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Figure EV5E - UMAP of aggregated WAT and BAT after regression, grouped by CC phase                         | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure EV5F - Cell count of each cluster in phase before CC regression                                     | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Figure EV5G - WAT and BAT cluster distribution in aggregated clusters by cell number count                 | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Figure 4A left -  UMAP of aggreagated WAT and BAT after CC regression                                      | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure 4A top right -  UMAP of aggreagated WAT and BAT after CC regression, highlighting cells from WAT    | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure 4A bottom right -  UMAP of aggreagated WAT and BAT after CC regression, highlighting cells from BAT | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure 4B left - Depot composition of WAT BAT aggregate                                                    | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Figure 4B right and 4C - WAT and BAT cluster distribution in aggregated clusters by percentage             | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             | data table was saved from R and plotted in Graphpad Prism                                                                                                                      |
| Figure 4D- representative markers of cluster 8 (combined FAPLs)                                            | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure 4E - Feature plots of depot markers                                                                 | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             |                                                                                                                                                                                |
| Figure 4F - co-upregulated genes of wFAPLs and bFAPLs; wCAPs and bCAPs                                     | WAT+BAT              | Seurat merge, CC regression          | 1.Seurat Processing/aggregate_wat_bat_analysis.Rmd   | R             | Originally contrasted on comeparetwolists.com                                                                                                                                  |
| Fig. 5A - WAT Reference mapping of 5 datasets                                                              | WAT external dataset | Reference mapping                    | 1.Seurat Processing/wat_external_data_processing.Rmd | R             | Data downloaded from other papers. Find links in scripts.                                                                                                                      |
| Fig. 5B - WAT quantification of labeled cells from mapping                                                 | WAT external dataset | Reference mapping                    | 1.Seurat Processing/wat_external_data_processing.Rmd | R             | Data downloaded from other papers. Find links in scripts.                                                                                                                      |
| Fig. EV6A - WAT other paper's markers on our datasets                                                      | WAT external dataset | Reference mapping                    | 1.Seurat Processing/wat_external_data_processing.Rmd | R             | Data downloaded from other papers. Find links in scripts.                                                                                                                      |
| Fig. EV6B - data for dot plots of shared wFAPLs markers. final dot plot was plotted in Graphpad Prism.     | WAT external dataset | Reference mapping                    | 1.Seurat Processing/wat_external_data_processing.Rmd | R             | data for each dot plot was saved and combined in 1 big dot plot in Graphpad Prism                                                                                              |
| Fig. 5C - BAT Reference mapping of 2 datasets                                                              | BAT external dataset | Reference mapping                    | 1.Seurat Processing/bat_external_data_processing.Rmd | R             | Data downloaded from other papers. Find links in scripts.                                                                                                                      |
| Fig. 5D - BAT quantification of labeled cells from mapping                                                 | BAT external dataset | Reference mapping                    | 1.Seurat Processing/bat_external_data_processing.Rmd | R             | Data downloaded from other papers. Find links in scripts.                                                                                                                      |

## Contact
hoangbvt223@gmail.com - hvbui@wisc.edu - https://www.linkedin.com/in/hoang-bui-a1256b121/
